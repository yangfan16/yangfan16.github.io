<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/uploads/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16.png"><link rel="mask-icon" href="/uploads/safari-pinned-tab.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.yangfan16.cn",root:"/",scheme:"Mist",version:"7.8.0",exturl:!1,sidebar:{position:"right",display:"hide",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!0,pangu:!0,comments:{style:"buttons",active:"gitalk",storage:!0,lazyload:!1,nav:null,activeClass:"gitalk"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="有限状态机(FSM)是计算的基本概念，在现实生活中发现许多FSM行为，例如自动售货机，电梯，交通信号灯等。基于FSM的编程也是建模复杂状态转换的强大工具，它可以大大简化我们的程序。  什么是有限状态机 有限状态机（FSM）或简称为状态机，是计算的数学模型。它是一种抽象机器，在任何给定时间都可以恰好处于有限数量的状态之一。FSM可以响应某些输入而从一种状态更改为另一种状态。从一种状态到另一种状态的"><meta property="og:type" content="article"><meta property="og:title" content="Go实现有限状态机"><meta property="og:url" content="https://blog.yangfan16.cn/go/go-state-machine/index.html"><meta property="og:site_name" content="青梅梦呓"><meta property="og:description" content="有限状态机(FSM)是计算的基本概念，在现实生活中发现许多FSM行为，例如自动售货机，电梯，交通信号灯等。基于FSM的编程也是建模复杂状态转换的强大工具，它可以大大简化我们的程序。  什么是有限状态机 有限状态机（FSM）或简称为状态机，是计算的数学模型。它是一种抽象机器，在任何给定时间都可以恰好处于有限数量的状态之一。FSM可以响应某些输入而从一种状态更改为另一种状态。从一种状态到另一种状态的"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/9/9e/Turnstile_state_machine_colored.svg"><meta property="og:image" content="https://miro.medium.com/max/700/1*O_2x8lMfIF4XjnAjoJcfEw.png"><meta property="og:image" content="https://miro.medium.com/max/700/1*bnQTaea8YizYi5SPPsSU0g.png"><meta property="article:published_time" content="2020-08-20T00:09:14.000Z"><meta property="article:modified_time" content="2020-08-22T16:04:39.959Z"><meta property="article:author" content="青梅煮马"><meta property="article:tag" content="go"><meta property="article:tag" content="state-machine"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/9/9e/Turnstile_state_machine_colored.svg"><link rel="canonical" href="https://blog.yangfan16.cn/go/go-state-machine/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Go实现有限状态机 | 青梅梦呓</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">青梅梦呓</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">和世界交手的这许多年，你是否光彩依旧，兴致盎然</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i> 关于</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/yangfan16" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.yangfan16.cn/go/go-state-machine/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/uploads/avatar.png"><meta itemprop="name" content="青梅煮马"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="青梅梦呓"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Go实现有限状态机</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-08-20 08:09:14" itemprop="dateCreated datePublished" datetime="2020-08-20T08:09:14+08:00">2020-08-20</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>7.3k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>7 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>有限状态机(FSM)是计算的基本概念，在现实生活中发现许多FSM行为，例如自动售货机，电梯，交通信号灯等。基于FSM的编程也是建模复杂状态转换的强大工具，它可以大大简化我们的程序。</p></blockquote><h3 id="什么是有限状态机"><a href="#什么是有限状态机" class="headerlink" title="什么是有限状态机"></a>什么是有限状态机</h3><blockquote><p>有限状态机（FSM）或简称为状态机，是计算的数学模型。它是一种抽象机器，在任何给定时间都可以恰好处于有限数量的状态之一。FSM可以响应某些输入而从一种状态更改为另一种状态。从一种状态到另一种状态的变化称为过渡。<br>— 维基百科</p></blockquote><p>FSM由三个关键元素组成：初始状态，所有可能状态的列表，触发状态转换的输入。<br>让我们将旋转栅栏作为FSM建模的简单示例。</p><a id="more"></a><p><img data-src="https://upload.wikimedia.org/wikipedia/commons/9/9e/Turnstile_state_machine_colored.svg" alt="维基百科的旋转栅栏状态图"></p><p>像其他FSM一样，旋转闸门的状态机包含三个元素：</p><ul><li>其初始状态为“锁定”</li><li>它有两个可能的状态：“锁定”和“解锁”</li><li>有两个输入将触发状态更改：“Push”和“Coin”</li></ul><h3 id="Go建立基于FSM的程序"><a href="#Go建立基于FSM的程序" class="headerlink" title="Go建立基于FSM的程序"></a>Go建立基于FSM的程序</h3><p>将构建一个命令行程序来模拟旋转栅门的行为。程序启动时，提示用户键入一些命令，然后它将根据输入的命令更改其状态。</p><h4 id="版本一-简单形式实现FSM"><a href="#版本一-简单形式实现FSM" class="headerlink" title="版本一 简单形式实现FSM"></a>版本一 简单形式实现FSM</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// State the FSM state for turnstile</span></span><br><span class="line"><span class="keyword">type</span> State <span class="keyword">uint32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// Locked locked state</span></span><br><span class="line">	Locked State = <span class="literal">iota</span></span><br><span class="line">	<span class="comment">// Unlocked unlocked state</span></span><br><span class="line">	Unlocked</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// CmdCoin command coin</span></span><br><span class="line">	CmdCoin = <span class="string">"coin"</span></span><br><span class="line">	<span class="comment">// CmdPush command push</span></span><br><span class="line">	CmdPush = <span class="string">"push"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	state := Locked</span><br><span class="line">	reader := bufio.NewReader(os.Stdin)</span><br><span class="line">	prompt(state)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		cmd, err := reader.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line">		cmd = strings.TrimSpace(cmd)</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">switch</span> state &#123;</span><br><span class="line">		<span class="keyword">case</span> Locked:</span><br><span class="line">			<span class="keyword">if</span> cmd == CmdCoin &#123;</span><br><span class="line">				fmt.Println(<span class="string">"unlocked, ready for pass through"</span>)</span><br><span class="line">				state = Unlocked</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> cmd == CmdPush &#123;</span><br><span class="line">				fmt.Println(<span class="string">"not allowed, unlock first"</span>)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"unknown command, try again please"</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> Unlocked:</span><br><span class="line">			<span class="keyword">if</span> cmd == CmdCoin &#123;</span><br><span class="line">				fmt.Println(<span class="string">"well, don't waste your coin"</span>)</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> cmd == CmdPush &#123;</span><br><span class="line">				fmt.Println(<span class="string">"pass through, shift back to locked"</span>)</span><br><span class="line">				state = Locked</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">"unknown command, try again please"</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prompt</span><span class="params">(s State)</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[State]<span class="keyword">string</span>&#123;</span><br><span class="line">		Locked:   <span class="string">"Locked"</span>,</span><br><span class="line">		Unlocked: <span class="string">"Unlocked"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"current state is [%s], please input command [coin|push]\n"</span>, m[s])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先，定义两个状态（Locked &amp; Unlocked）和两个有效命令（CmdCoin &amp; CmdPush）。在函数中main，我们将初始状态设置为Locked，向用户打印使用情况信息。然后开始主循环，从中读取命令字符串stdin，根据当前状态处理该命令。</p><p>您可能会注意到，我们必须为每个状态处理未知命令，这可以通过较小的重构得到改善。此外，如果将状态转换逻辑提取到函数中，则程序将更具表现力。</p><h4 id="版本二-重构代码以使得更加清晰"><a href="#版本二-重构代码以使得更加清晰" class="headerlink" title="版本二 重构代码以使得更加清晰"></a>版本二 重构代码以使得更加清晰</h4><p>在主循环中我们只关心，输入的有效命令和初始状态，完全可以将状态装换的逻辑代码抽成一个单独的函数，具体代码如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// State the FSM state for turnstile</span></span><br><span class="line"><span class="comment">// 指出FSM的状态以便表示旋转门</span></span><br><span class="line"><span class="keyword">type</span> State <span class="keyword">uint32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// Locked locked state</span></span><br><span class="line">	<span class="comment">// 锁定状态</span></span><br><span class="line">	Locked State = <span class="literal">iota</span></span><br><span class="line">	<span class="comment">// Unlocked unlocked state</span></span><br><span class="line">	<span class="comment">// 解锁状态</span></span><br><span class="line">	Unlocked</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// CmdCoin command coin</span></span><br><span class="line">	<span class="comment">// 命令CmdCoin表示coin输入</span></span><br><span class="line">	CmdCoin = <span class="string">"coin"</span></span><br><span class="line">	<span class="comment">// CmdPush command push</span></span><br><span class="line">	<span class="comment">// 命令CmdPush表示push输入</span></span><br><span class="line">	CmdPush = <span class="string">"push"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	state := Locked</span><br><span class="line">	reader := bufio.NewReader(os.Stdin)</span><br><span class="line">	prompt(state)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		cmd, err := reader.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line">		state = step(state, strings.TrimSpace(cmd))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">step</span><span class="params">(state State, cmd <span class="keyword">string</span>)</span> <span class="title">State</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> cmd != CmdCoin &amp;&amp; cmd != CmdPush &#123;</span><br><span class="line">		fmt.Println(<span class="string">"unknown command, try again please"</span>)</span><br><span class="line">		<span class="keyword">return</span> state</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> state &#123;</span><br><span class="line">	<span class="keyword">case</span> Locked:</span><br><span class="line">		<span class="keyword">if</span> cmd == CmdCoin &#123;</span><br><span class="line">			fmt.Println(<span class="string">"unlocked, ready for pass through"</span>)</span><br><span class="line">			state = Unlocked</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"not allowed, unlock first"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">case</span> Unlocked:</span><br><span class="line">		<span class="keyword">if</span> cmd == CmdCoin &#123;</span><br><span class="line">			fmt.Println(<span class="string">"well, don't waste your coin"</span>)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"pass through, shift back to locked"</span>)</span><br><span class="line">			state = Locked</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prompt</span><span class="params">(s State)</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[State]<span class="keyword">string</span>&#123;</span><br><span class="line">		Locked:   <span class="string">"Locked"</span>,</span><br><span class="line">		Unlocked: <span class="string">"Unlocked"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"current state is [%s], please input command [coin|push]\n"</span>, m[s])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际上，状态机通常由<a href="https://en.wikipedia.org/wiki/State-transition_table" target="_blank" rel="noopener">State-Transition Table</a>表示，对于我们的旋转门示例，该表如下所示：<br><img data-src="https://miro.medium.com/max/700/1*O_2x8lMfIF4XjnAjoJcfEw.png" alt="维基百科的状态转换表"></p><p>我们可以使用转换表来实现FSM</p><h4 id="版本三-状态转换表"><a href="#版本三-状态转换表" class="headerlink" title="版本三 状态转换表"></a>版本三 状态转换表</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// State the FSM state for turnstile</span></span><br><span class="line"><span class="comment">// 指出FSM的状态以便表示旋转门</span></span><br><span class="line"><span class="keyword">type</span> State <span class="keyword">uint32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// Locked locked state</span></span><br><span class="line">	<span class="comment">// 锁定状态</span></span><br><span class="line">	Locked State = <span class="literal">iota</span></span><br><span class="line">	<span class="comment">// Unlocked unlocked state</span></span><br><span class="line">	<span class="comment">// 解锁状态</span></span><br><span class="line">	Unlocked</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// CmdCoin command coin</span></span><br><span class="line">	<span class="comment">// 命令CmdCoin表示coin输入</span></span><br><span class="line">	CmdCoin = <span class="string">"coin"</span></span><br><span class="line">	<span class="comment">// CmdPush command push</span></span><br><span class="line">	<span class="comment">// 命令CmdPush表示push输入</span></span><br><span class="line">	CmdPush = <span class="string">"push"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	state := Locked</span><br><span class="line">	reader := bufio.NewReader(os.Stdin)</span><br><span class="line">	prompt(state)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// read command from stdin</span></span><br><span class="line">		cmd, err := reader.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// get function from transition table</span></span><br><span class="line">		<span class="comment">//从状态转换表里面获取状态</span></span><br><span class="line">		tupple := CommandStateTupple&#123;strings.TrimSpace(cmd), state&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> f := StateTransitionTable[tupple]; f == <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"unknown command, try again please"</span>)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			f(&amp;state)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CommandStateTupple tupple for state-command combination</span></span><br><span class="line"><span class="comment">// 状态命令组合的元组</span></span><br><span class="line"><span class="keyword">type</span> CommandStateTupple <span class="keyword">struct</span> &#123;</span><br><span class="line">	Command <span class="keyword">string</span></span><br><span class="line">	State   State</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransitionFunc transition function</span></span><br><span class="line"><span class="comment">// 状态转换函数</span></span><br><span class="line"><span class="keyword">type</span> coin <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// StateTransitionTable trsition table</span></span><br><span class="line"><span class="comment">//状态转换表</span></span><br><span class="line"><span class="keyword">var</span> StateTransitionTable = <span class="keyword">map</span>[CommandStateTupple]TransitionFunc&#123;</span><br><span class="line">	&#123;CmdCoin, Locked&#125;: <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"unlocked, ready for pass through"</span>)</span><br><span class="line">		*state = Unlocked</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;CmdPush, Locked&#125;: <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"not allowed, unlock first"</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;CmdCoin, Unlocked&#125;: <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"well, don't waste your coin"</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;CmdPush, Unlocked&#125;: <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"pass through, shift back to locked"</span>)</span><br><span class="line">		*state = Locked</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prompt</span><span class="params">(s State)</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[State]<span class="keyword">string</span>&#123;</span><br><span class="line">		Locked:   <span class="string">"Locked"</span>,</span><br><span class="line">		Unlocked: <span class="string">"Unlocked"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"current state is [%s], please input command [coin|push]\n"</span>, m[s])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用这种方法，所有可能的转换都在表中列出。易于维护和理解。如果需要新的转换，只需添加一个表条目。<br>由于FSM是抽象机器，因此我们可以更进一步，并以面向对象的方式实现它。</p><h4 id="版本四-使用类对FSM进行建模"><a href="#版本四-使用类对FSM进行建模" class="headerlink" title="版本四 使用类对FSM进行建模"></a>版本四 使用类对FSM进行建模</h4><p>Turnstile引入了一个新类，它具有一个属性State，即名为的方法ExecuteCmd。<br>触发状态转换的唯一方法是调用方法ExecuteCmd。<br>该关系可以用下面的图表示：</p><p><img data-src="https://miro.medium.com/max/700/1*bnQTaea8YizYi5SPPsSU0g.png" alt="oop类图"></p><p>重新写一下代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// State the FSM state for turnstile</span></span><br><span class="line"><span class="keyword">type</span> State <span class="keyword">uint32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// Locked locked state</span></span><br><span class="line">	Locked State = <span class="literal">iota</span></span><br><span class="line">	<span class="comment">// Unlocked unlocked state</span></span><br><span class="line">	Unlocked</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// CmdCoin command coin</span></span><br><span class="line">	CmdCoin = <span class="string">"coin"</span></span><br><span class="line">	<span class="comment">// CmdPush command push</span></span><br><span class="line">	CmdPush = <span class="string">"push"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Turnstile the finite state machine</span></span><br><span class="line"><span class="keyword">type</span> Turnstile <span class="keyword">struct</span> &#123;</span><br><span class="line">	State State</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ExecuteCmd execute command</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Turnstile)</span> <span class="title">ExecuteCmd</span><span class="params">(cmd <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// get function from transition table</span></span><br><span class="line">	tupple := CmdStateTupple&#123;strings.TrimSpace(cmd), p.State&#125;</span><br><span class="line">	<span class="keyword">if</span> f := StateTransitionTable[tupple]; f == <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"unknown command, try again please"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		f(&amp;p.State)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	machine := &amp;Turnstile&#123;State: Locked&#125;</span><br><span class="line">	prompt(machine.State)</span><br><span class="line">	reader := bufio.NewReader(os.Stdin)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// read command from stdin</span></span><br><span class="line">		cmd, err := reader.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		machine.ExecuteCmd(cmd)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CmdStateTupple tupple for state-command combination</span></span><br><span class="line"><span class="keyword">type</span> CmdStateTupple <span class="keyword">struct</span> &#123;</span><br><span class="line">	Cmd   <span class="keyword">string</span></span><br><span class="line">	State State</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransitionFunc transition function</span></span><br><span class="line"><span class="keyword">type</span> TransitionFunc <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// StateTransitionTable trsition table</span></span><br><span class="line"><span class="keyword">var</span> StateTransitionTable = <span class="keyword">map</span>[CmdStateTupple]TransitionFunc&#123;</span><br><span class="line">	&#123;CmdCoin, Locked&#125;: <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"unlocked, ready for pass through"</span>)</span><br><span class="line">		*state = Unlocked</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;CmdPush, Locked&#125;: <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"not allowed, unlock first"</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;CmdCoin, Unlocked&#125;: <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"well, don't waste your coin"</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;CmdPush, Unlocked&#125;: <span class="function"><span class="keyword">func</span><span class="params">(state *State)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"pass through, shift back to locked"</span>)</span><br><span class="line">		*state = Locked</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prompt</span><span class="params">(s State)</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[State]<span class="keyword">string</span>&#123;</span><br><span class="line">		Locked:   <span class="string">"Locked"</span>,</span><br><span class="line">		Unlocked: <span class="string">"Unlocked"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"current state is [%s], please input command [coin|push]\n"</span>, m[s])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>简单学习了FSM的概念并构建了一个基于FSM的Go程序，实现了这个程序的四个版本：</p><ul><li>v1，以简单的形式实现FSM。</li><li>进行一些重构，抽出函数以减少代码重复</li><li>使用状态转换表</li><li>采用OOP的方式进行重构</li></ul><p>状态机的思想在编码中还是会遇到，例如解耦一些复杂的任务，实现接口幂等，分解程序逻辑，使得代码更急清晰等等。</p></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/go/actions-go/" rel="bookmark">GitHub Actions 自动化构建Go应用</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/go/go-conns-pool/" rel="bookmark">Go实现通用网络连接池</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/go/go-map/" rel="bookmark">理解Go语言的哈希表</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/go/go-slice-array/" rel="bookmark">理解Go语言数组和切片</a></div></li></ul><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 青梅煮马</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://blog.yangfan16.cn/go/go-state-machine/" title="Go实现有限状态机">https://blog.yangfan16.cn/go/go-state-machine/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/go/" rel="tag"><i class="fa fa-tag"></i> go</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/go/go-conns-pool/" rel="prev" title="Go实现通用网络连接池"><i class="fa fa-chevron-left"></i> Go实现通用网络连接池</a></div><div class="post-nav-item"> <a href="/go/go-map/" rel="next" title="理解Go语言的哈希表">理解Go语言的哈希表<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是有限状态机"><span class="nav-number">1.</span> <span class="nav-text">什么是有限状态机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Go建立基于FSM的程序"><span class="nav-number">2.</span> <span class="nav-text">Go建立基于FSM的程序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#版本一-简单形式实现FSM"><span class="nav-number">2.1.</span> <span class="nav-text">版本一 简单形式实现FSM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#版本二-重构代码以使得更加清晰"><span class="nav-number">2.2.</span> <span class="nav-text">版本二 重构代码以使得更加清晰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#版本三-状态转换表"><span class="nav-number">2.3.</span> <span class="nav-text">版本三 状态转换表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#版本四-使用类对FSM进行建模"><span class="nav-number">2.4.</span> <span class="nav-text">版本四 使用类对FSM进行建模</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="青梅煮马" src="/uploads/avatar.png"><p class="site-author-name" itemprop="name">青梅煮马</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/yangfan16" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yangfan16" rel="noopener" target="_blank"><i class="github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:yangfan9915@gmail.com" title="E-Mail → mailto:yangfan9915@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://weibo.com/52012536" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;52012536" rel="noopener" target="_blank"><i class="weibo fa-fw"></i> Weibo</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="link fa-fw"></i> 大佬博客链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://think2011.net/" title="https:&#x2F;&#x2F;think2011.net&#x2F;" rel="noopener" target="_blank">曾浩的博客</a></li><li class="links-of-blogroll-item"> <a href="https://ninghao.net/blog" title="https:&#x2F;&#x2F;ninghao.net&#x2F;blog" rel="noopener" target="_blank">王皓的博客</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17005352号-2</a> <img src="/uploads/beian.png" style="display:inline-block"></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">青梅煮马</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">104k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">1:35</span></div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e79f11b160a4070" async="async"></script></div></div></footer></div><script size="200" alpha="0.4" zindex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script><script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js"></script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script><script data-pjax>CONFIG.page.isPost&&(wpac_init=window.wpac_init||[],wpac_init.push({widget:"Rating",id:10254,el:"wpac-rating",color:"fc6423"}),function(){if(!("WIDGETPACK_LOADED"in window)){WIDGETPACK_LOADED=!0;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//embed.widgetpack.com/widget.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t.nextSibling)}}())</script><div id="pjax"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'f9f42cb27214f7d10b14',
      clientSecret: '147d85755db76790cff0442b7f5123e0032cba08',
      repo        : 'gitalk',
      owner       : 'yangfan16',
      admin       : ['yangfan16'],
      id          : '259d15274894d84ec12a02a92f48fe5a',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></div></body></html>